<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pinterest Scraper</title>
<style>
  :root{
    --bg:#0b0b0d; --panel:#111215; --muted:#9aa0a6; --accent:#7c4dff; --btn-hover:#5f3be6;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; background:var(--bg); color:#e7e7e7; padding:16px;}
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;max-width:900px;margin:0 auto}
  h1{font-size:18px;margin:0}
  .controls{display:flex;gap:8px;flex:1;margin-left:12px}
  input{flex:1;padding:10px;border-radius:8px;border:1px solid #222;background:#0f0f11;color:var(--muted);outline:none}
  button{background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
  button:hover{background:var(--btn-hover)}
  .hint{font-size:13px;color:var(--muted);margin-top:8px;text-align:center}
  #results{max-width:1000px;margin:18px auto 120px;display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;padding:0 8px}
  .card{background:var(--panel);border-radius:10px;overflow:hidden;position:relative;min-height:100px;display:flex;align-items:center;justify-content:center}
  .card img{width:100%;height:auto;display:block;object-fit:cover}
  .dl{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);background:rgba(124,77,255,0.95);color:#06060a;border:none;padding:6px 8px;border-radius:6px;font-weight:600;cursor:pointer;font-size:13px}
  .small{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}
  .loading{color:var(--muted);text-align:center;padding:20px}
  footer{position:fixed;left:0;right:0;bottom:0;padding:8px 12px;background:linear-gradient(0deg, rgba(0,0,0,0.6), transparent);text-align:center;color:var(--muted);font-size:13px}
  @media (max-width:480px){
    header{flex-wrap:wrap;gap:8px}
    h1{font-size:16px}
    .controls{width:100%}
  }
</style>
</head>
<body>
<header>
  <h1>Pinterest Scraper </h1>
  <div class="controls">
    <input id="q" placeholder="Ketik keyword, contoh: kucing lucu" />
    <button id="go">Search</button>
  </div>
</header>

<div class="hint">Menggunakan scraping best-effort dari Pinterest via public CORS-proxy. Kadang hasil kosong karena Pinterest render pake JS.</div>

<div id="results"></div>
<div id="info" class="small"></div>

<footer>Host di GitHub Pages — Jika sering gagal, pake layanan scraping/headless di backend.</footer>

<script>
const proxies = [
  // public proxies (bisa berubah kapan aja)
  "https://api.allorigins.win/get?url=",
  "https://thingproxy.freeboard.io/fetch/",
  "https://api.allorigins.cf/get?url=" // fallback (kadang)
];

const resultsEl = document.getElementById('results');
const infoEl = document.getElementById('info');

function sanitizeUrl(u){
  try{
    return decodeURIComponent(u).replace(/\\u002F/g,'/').replace(/"/g,'').trim();
  }catch(e){ return u; }
}

async function fetchViaProxy(target){
  // try proxies sequentially
  for(const p of proxies){
    try{
      const full = p.includes('?url=') ? p + encodeURIComponent(target) : p + target;
      const res = await fetch(full);
      if(!res.ok) continue;
      // allorigins returns JSON {contents: "...", status: {...}}
      const txt = await res.text();
      // unify: if JSON with .contents, parse
      let body = txt;
      try{
        const j = JSON.parse(txt);
        if(j && j.contents) body = j.contents;
      }catch(e){}
      if(body && body.length>100) return body;
    }catch(e){
      // continue to next proxy
    }
  }
  throw new Error("Gagal fetch via semua proxy");
}

function extractImages(html){
  const imgs = new Set();
  // 1) cari direct i.pinimg.com url jpg/png
  const re1 = /https?:\\/\\/i\\.pinimg\\.com\\/[^"'>\\s]+\\.(?:jpg|jpeg|png)/gi;
  let m;
  while((m = re1.exec(html)) !== null) imgs.add(sanitizeUrl(m[0]));
  // 2) cari srcset / data-src / data-image
  const re2 = /(?:src|data-src|data-image|srcset)=["']([^"']*i\\.pinimg\\.com[^"']+)["']/gi;
  while((m = re2.exec(html)) !== null) imgs.add(sanitizeUrl(m[1]));
  // 3) coba parse JSON blobs yang mungkin berisi "images": {"orig": {"url":"..."}}
  const re3 = /"url":"(https?:\\\\/\\\\/i\\.pinimg\\.com\\\\/[^"]+\\.(?:jpg|png|jpeg))"/gi;
  while((m = re3.exec(html)) !== null) imgs.add(sanitizeUrl(m[1].replace(/\\\\u002F/g,'/').replace(/\\\\/g,'')));
  return Array.from(imgs);
}

function clearResults(){ resultsEl.innerHTML = ''; infoEl.textContent = ''; }

function showLoading(txt){ clearResults(); resultsEl.innerHTML = `<div class="loading">${txt}</div>`; }

function createCard(src){
  const div = document.createElement('div');
  div.className = 'card';
  const img = document.createElement('img');
  img.src = src;
  img.loading = 'lazy';
  img.onerror = ()=>{ div.remove(); };
  const btn = document.createElement('button');
  btn.className = 'dl';
  btn.textContent = 'Download';
  btn.onclick = ()=>downloadImage(src);
  div.appendChild(img);
  div.appendChild(btn);
  return div;
}

function downloadImage(url){
  // open in new tab with direct url to let browser download or user long-press on mobile
  // create anchor for desktop auto-download
  const a = document.createElement('a');
  a.href = url;
  a.download = url.split('/').pop().split('?')[0];
  document.body.appendChild(a);
  try{ a.click(); }catch(e){ window.open(url, '_blank'); }
  a.remove();
}

document.getElementById('go').addEventListener('click', async ()=>{
  const q = document.getElementById('q').value.trim();
  if(!q){ alert('Isi keyword dulu cok!'); return; }
  clearResults();
  showLoading('Mencari di Pinterest... (ini best-effort, sabar ya)');
  const target = `https://www.pinterest.com/search/pins/?q=${encodeURIComponent(q)}`;
  try{
    const html = await fetchViaProxy(target);
    const imgs = extractImages(html);
    if(imgs.length === 0){
      resultsEl.innerHTML = `<div class="loading">Gagal menemukan gambar via scraping HTML. Coba ulang atau pakai layanan headless (bot) untuk akurasi.</div>`;
      infoEl.textContent = 'Tips: scroll manual di Pinterest lalu copy URL board/pin dan coba lagi.';
      return;
    }
    resultsEl.innerHTML = '';
    // limit to 36
    imgs.slice(0,36).forEach(s => resultsEl.appendChild(createCard(s)));
    infoEl.textContent = `Menampilkan ${Math.min(imgs.length,36)} gambar. Sumber: Pinterest (scraped).`;
  }catch(err){
    resultsEl.innerHTML = `<div class="loading">Gagal fetch: ${err.message}. Coba refresh atau gunakan VPN/proxy berbeda.</div>`;
    infoEl.textContent = 'Jika terus gagal, Pinterest menyajikan data via JS — butuh backend headless untuk hasil stabil.';
  }
});

// allow Enter key
document.getElementById('q').addEventListener('keydown', (e)=>{ if(e.key==='Enter') document.getElementById('go').click(); });

</script>
</body>
</html>
